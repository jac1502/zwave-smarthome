/*
	Copyright Kamil PÄ™kala http://github.com/kamilkp
	angular-sortable-view v0.0.13 2015/01/13
*/
!function(e,t){"use strict";function n(e){var n,o=t.element();for(e=t.element(e),n=0;n<this.length;n++)o.push(this[n]);for(n=0;n<e.length;n++)o.push(e[n]);return o}function o(e){if(void 0===e.clientX&&void 0===e.clientY){var t=e.touches||e.originalEvent.touches;t&&t.length&&(e.clientX=t[0].clientX,e.clientY=t[0].clientY)}e.preventDefault()}function r(e){if((e=e[0]).previousElementSibling)return t.element(e.previousElementSibling);for(var n=e.previousSibling;null!=n&&1!=n.nodeType;)n=n.previousSibling;return t.element(n)}function i(e,t){return parseInt(e.css(t))||0}function l(e,n){var o={},r=t.element(e),l=e.getBoundingClientRect(),s=n?i:function(){return 0};return o.left=l.left-s(r,"margin-left")-s(r,"border-left"),o.right=l.right+s(r,"margin-right")+s(r,"border-right"),o.top=l.top-s(r,"margin-top")-s(r,"border-top"),o.bottom=l.bottom+s(r,"margin-bottom")+s(r,"border-bottom"),o.width=o.right-o.left,o.height=o.bottom-o.top,o}function s(e,t){var n=r(e);n.length>0?n.after(t):e.parent().prepend(t)}function c(n){for(var o=n.parent(),r=e.getComputedStyle(o[0]);o.length>0&&"HTML"!==o[0].tagName&&"static"===r.position&&("none"===r.transform||!r.transform);)o=o.parent(),r=e.getComputedStyle(o[0]);return 0===o.length&&(o=t.element(document.documentElement)),o}function a(t){for(var n={left:t.offsetLeft,top:t.offsetTop},o=t.parentNode,r=e.getComputedStyle(o);o&&"BODY"!==o.tagName&&"static"===r.position;)n.top-=o.scrollTop,n.left-=o.scrollLeft,o=o.parentNode,r=e.getComputedStyle(o);return n}function d(t){for(var n,o=[];t&&t!==document.body;)"auto"!==(n=e.getComputedStyle(t)).overflowY&&"scroll"!==n.overflowY||o.push(t),t=t.parentNode;return o.push(document.documentElement),o}function u(e,n){if(e instanceof t.element&&(e=e[0]),null!==h)return e[h](n)}var m=300;t.element(document.head).append(["<style>.sv-helper{position: absolute !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));var p=document.documentElement,h=p.matches?"matches":p.matchesSelector?"matchesSelector":p.webkitMatches?"webkitMatches":p.webkitMatchesSelector?"webkitMatchesSelector":p.msMatches?"msMatches":p.msMatchesSelector?"msMatchesSelector":p.mozMatches?"mozMatches":p.mozMatchesSelector?"mozMatchesSelector":null;if(null==h)throw"This browser doesn't support the HTMLElement.matches method";var v=t.element.prototype.closest||function(e){for(var n=this[0].parentNode;n!==document.documentElement&&!n[h](e);)n=n.parentNode;return n[h](e)?t.element(n):t.element()},f=!1;try{var g=Object.defineProperty({},"passive",{get:function(){f=!0}});e.addEventListener("test",null,g)}catch(e){}var y=t.module("angular-sortable-view",[]);y.directive("svRoot",[function(){function t(e,t,n){return n?e.x-t.x<0:e.y-t.y<0}function n(e){return i[e]}function o(e){delete i[e]}var r,i=Object.create(null),c=0;return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse","$element",function(m,p,h,f,g){var y,$,b,w,x,C,E,S=h(p.svRoot)(m)||++c,T=!1,M=f(p.svOnSort),R=!1,P=d(g[0]);i[S]||(i[S]=[]),p.svOnStart=p.$$element[0].attributes["sv-on-start"],p.svOnStart=p.svOnStart&&p.svOnStart.value,p.svOnStop=p.$$element[0].attributes["sv-on-stop"],p.svOnStop=p.svOnStop&&p.svOnStop.value;var O=f(p.svOnStart),L=f(p.svOnStop),k=function(e,t,n){var o=n.scrollTop,r=Math.max(0,n.scrollHeight-(n===document.body?document.documentElement.clientHeight:n.clientHeight)),i=Math.min(Math.max(0,n.scrollTop+e),r);R=!0,i!==o?(n.scrollTop=i,clearTimeout(E),E=setTimeout(function(){E=null,R&&k(e,t,n)},t)):R=!1};if(this.sortingInProgress=function(){return r},this.stopScrolling=function(){E&&(clearTimeout(E),E=null),R=!1},p.svGrid){if(null===(T="true"===p.svGrid||"false"!==p.svGrid&&null))throw"Invalid value of sv-grid attribute"}else m.$watchCollection(function(){return n(S)},function(e){T=!1;var t=e.filter(function(e){return!e.container}).map(function(e){return{part:e.getPart().id,y:e.element[0].getBoundingClientRect().top}}),n=Object.create(null);t.forEach(function(e){n[e.part]?n[e.part].push(e.y):n[e.part]=[e.y]}),Object.keys(n).forEach(function(e){n[e].sort(),n[e].forEach(function(t,o){o<n[e].length-1&&t>0&&t===n[e][o+1]&&(T=!0)})})});this.$moveUpdate=function(o,i,c,a,d,p,h){var f,E,M=o.containment&&v.call(c,o.containment)[0],L=c[0].getBoundingClientRect(),B=(g[0].getBoundingClientRect(),M&&M.getBoundingClientRect());"element"===o.tolerance&&(i={x:~~(L.left+L.width/2),y:~~(L.top+L.height/2)}),$||(d?($=d.clone()).removeClass("ng-hide"):(($=a.clone()).addClass("sv-visibility-hidden"),$.addClass("sv-placeholder"),$.css({height:L.height+"px",width:L.width+"px"})),a.after($),a.addClass("ng-hide"),x=a,b=o,O(m,{$helper:{element:w=c},$part:p.model(p.scope),$index:h,$item:p.model(p.scope)[h]}),m.$root&&m.$root.$$phase||m.$apply()),E={x:~~((f=$[0].getBoundingClientRect()).left+f.width/2),y:~~(f.top+f.height/2)},r=!0,y=[],w[0].reposition({x:i.x-i.offset.x*L.width,y:i.y-i.offset.y*L.height},B),n(S).forEach(function(e,n){if(null==o.containment||u(e.element,o.containment)||u(e.element,o.containment+" *")){var r=e.element[0].getBoundingClientRect(),l={x:~~(r.left+r.width/2),y:~~(r.top+r.height/2)};e.container||!e.element[0].scrollHeight&&!e.element[0].scrollWidth||y.push({element:e.element,q:(l.x-i.x)*(l.x-i.x)+(l.y-i.y)*(l.y-i.y),view:e.getPart(),targetIndex:e.getIndex(),after:t(l,i,T)}),e.container&&!e.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&y.push({element:e.element,q:(l.x-i.x)*(l.x-i.x)+(l.y-i.y)*(l.y-i.y),view:e.getPart(),targetIndex:0,container:!0})}}),y.push({q:(E.x-i.x)*(E.x-i.x)+(E.y-i.y)*(E.y-i.y),element:$,placeholder:!0}),y.sort(function(e,t){return e.q-t.q}),y.forEach(function(e,t){0!==t||e.placeholder||e.container?0===t&&e.container?(C=e,e.element.append($)):e.element.removeClass("sv-candidate"):(C=e,e.element.addClass("sv-candidate"),e.after?e.element.after($):s(e.element,$))}),L=l(c[0],!0);for(var q,H,I=0,N=P.length;I<N;I++){if(q=P[I],H=q.getBoundingClientRect(),q===document.documentElement&&document.body.scrollTop>0&&(q=document.body),q.scrollTop>0&&(H.top>L.top||L.top<=0)){k(-5,200,q);break}if(q.scrollTop<q.scrollHeight-(q===document.body?document.documentElement:q).clientHeight&&(q!==document.body&&q!==document.documentElement&&H.bottom<L.bottom||L.bottom>e.innerHeight)){k(5,200,q);break}R&&this.stopScrolling()}},this.$drop=function(e,t,n){function o(){if(r=!1,$.remove(),w.remove(),x.removeClass("ng-hide"),y=void 0,$=void 0,n=void 0,w=void 0,x=void 0,L(m,{$part:e.model(e.scope),$index:t,$item:e.model(e.scope)[t]}),C){C.element.removeClass("sv-candidate");var o=e.model(e.scope).splice(t,1),i=C.targetIndex;C.view===e&&C.targetIndex>t&&i--,C.after&&i++,C.view.model(C.view.scope).splice(i,0,o[0]),C.view===e&&t===i||M(m,{$partTo:C.view.model(C.view.scope),$partFrom:e.model(e.scope),$item:o[0],$indexTo:i,$indexFrom:t})}C=void 0,m.$root&&m.$root.$$phase||m.$apply()}if($)if(n.revert){var i=$[0].getBoundingClientRect(),l=w[0].getBoundingClientRect(),s=Math.sqrt(Math.pow(l.top-i.top,2)+Math.pow(l.left-i.left,2)),c=+n.revert*s/200;c=Math.min(c,+n.revert),["-webkit-","-moz-","-ms-","-o-",""].forEach(function(e){void 0!==w[0].style[e+"transition"]&&(w[0].style[e+"transition"]="all "+c+"ms ease")}),setTimeout(o,c),w.css(a($[0]))}else o()},this.addToSortableElements=function(e){n(S).push(e)},this.removeFromSortableElements=function(e){var t=n(S),r=t.indexOf(e);r>-1&&(t.splice(r,1),0===t.length&&o(S))}}]}}]),y.directive("svPart",["$parse",function(e){return{restrict:"A",require:"^svRoot",controller:["$scope",function(e){e.$svRootCtrl=this,this.getPart=function(){return e.part},this.$drop=function(t,n){e.$sortableRoot.$drop(e.part,t,n)}}],scope:!0,link:function(t,n,o,r){if(!o.svPart)throw new Error("no model provided");var i=e(o.svPart);if(!i.assign)throw new Error("model not assignable");t.part={id:t.$id,element:n,model:i,scope:t},t.$sortableRoot=r;var l={element:n,getPart:t.$svRootCtrl.getPart,container:!0};r.addToSortableElements(l),t.$on("$destroy",function(){r.removeFromSortableElements(l)})}}}]),y.directive("svElement",["$parse",function(e){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(e){e.$svElementCtrl=this}],link:function(n,r,i,l){function s(){r.off("touchstart",a),y.off("touchstart",a),y.off("mousedown",d)}function a(e){function t(e){f?document.removeEventListener("touchmove",t,{passive:!1}):w.off("touchmove",t),n+m<Date.now()&&(e.preventDefault(),d(e,!0))}var n=Date.now();f?document.addEventListener("touchmove",t,{passive:!1}):w.on("touchmove",t)}function d(s,a){function d(e){l[1].stopScrolling(),w.off(g,m),w.off(v,d),f&&document.removeEventListener("touchmove",m,{passive:!1}),w.removeClass("sv-sorting-in-progress"),u&&l[0].$drop(n.$index,x),r.removeClass("sv-visibility-hidden")}function m(e){o(e),u||(r.parent().prepend(y),u=!0),l[1].$moveUpdate(x,{x:e.clientX,y:e.clientY,offset:C},y,r,h,l[0].getPart(),n.$index)}if(o(s),!l[1].sortingInProgress()&&(0==s.button||"mousedown"!==s.type)){var y,$=r,b=r[0].getBoundingClientRect(),x=e(i.svElement)(n),C={x:(s.clientX-b.left)/b.width,y:(s.clientY-b.top)/b.height};u=!1,x=t.extend({},{tolerance:"pointer",revert:200,containment:"html"},x),p||(p=l[0].helper),h||(h=l[0].placeholder),p?((y=p.clone()).removeClass("ng-hide"),$.addClass("sv-visibility-hidden")):(y=$.clone()).addClass("sv-helper").css({width:b.width+"px"}),y[0].reposition=function(e,t){var n,o,r,i,l=y[0].getBoundingClientRect(),s=c(y),a="HTML"===s[0].tagName,d=s[0].getBoundingClientRect(),u=d.top-(a?0:s[0].scrollTop),m=d.left-(a?0:s[0].scrollLeft),p=e.x-m,h=e.y-u;t&&(n=t.top-u+(a?document.body.scrollTop||document.documentElement.scrollTop:0),o=t.left-m+(a?document.body.scrollLeft||document.documentElement.scrollLeft:0),r=s[0].offsetTop+y[0].parentNode.offsetTop+n+t.height-1,i=s[0].offsetLeft+y[0].parentNode.offsetLeft+o+t.width,h=Math.min(r-l.height,Math.max(h,n)),p=Math.min(i-l.width,Math.max(p,o))),this.style.left=p+"px",this.style.top=h+"px"},w.addClass("sv-sorting-in-progress"),w.on(g,m).on(v,d),f&&document.addEventListener("touchmove",m,{passive:!1}),a&&m(s)}}var u,p,h,v="mouseup touchend touchcancel",g="mousemove"+(f?"":" touchmove"),y=r,$={element:r,getPart:l[0].getPart,getIndex:function(){return n.$index}},b=!1,w=t.element(document.documentElement);l[1].addToSortableElements($),n.$on("$destroy",function(){b=!0,s(),l[1].removeFromSortableElements($)}),r.on("touchstart",a),y.on("mousedown",d),n.$watch("$svElementCtrl.handle",function(e){e&&(s(),(y=e).on("touchstart",a),y.on("mousedown",d))}),n.$watch("$svElementCtrl.helper",function(e){e&&(p=e)}),n.$watch("$svElementCtrl.placeholder",function(e){e&&(h=e)})}}}]),y.directive("svHandle",function(){return{require:"?^svElement",link:function(e,t,o,r){r&&(r.handle=n.call(t,r.handle))}}}),y.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(e,t,n,o){t.addClass("sv-helper").addClass("ng-hide"),o[1]?o[1].helper=t:o[0]&&(o[0].helper=t)}}}),y.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(e,t,n,o){t.addClass("sv-placeholder").addClass("ng-hide"),o[1]?o[1].placeholder=t:o[0]&&(o[0].placeholder=t)}}})}(window,window.angular);